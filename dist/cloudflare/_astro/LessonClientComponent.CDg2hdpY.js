import{c as k,j as e,a as q,b as Se,C as T,d as I,e as _,B as Pe,f as E,g as ce,u as Z,h as de,P as $,i as pe,k as $e,l as me,m as Le,n as De,o as Oe,p as qe,L as He,q as R,s as c,r as L,t as ue,R as Be,v as Ve,w as Ye,x as oe,y as ie,z as Fe,A as y,D,E as M,F as S,G as P,H as ze,I as Qe,J as Ue,K as Ge,M as Ke,N as Je,T as Ze,O as Xe,S as We,Q as es}from"./dialog.BMZ84p1_.js";import{r as d,R as N}from"./index.CvKvpgP4.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ts=k("ArrowLeft",ss);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],as=k("MessageCircleQuestion",ns);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8",key:"1blaws"}]],K=k("MessageSquareHeart",rs);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]],is=k("MessageSquarePlus",os);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M16 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8Z",key:"qazsjp"}],["path",{d:"M15 3v4a2 2 0 0 0 2 2h4",key:"40519r"}]],cs=k("StickyNote",ls);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ps=k("TriangleAlert",ds),ms=Se("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function le({className:s,variant:n,...t}){return e.jsx("div",{className:q(ms({variant:n}),s),...t})}const us=({title:s,topic:n,level:t})=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-4xl font-bold text-primary mb-2",children:s}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{variant:"secondary",children:n}),e.jsx(le,{variant:t==="Beginner"?"default":t==="Intermediate"?"outline":"destructive",className:t==="Beginner"?"bg-accent text-accent-foreground":t==="Intermediate"?"border-accent text-accent-foreground":"bg-orange-500 text-white",children:t})]})]}),xs=({explanation:s})=>e.jsxs(T,{className:"mb-6 shadow-lg",children:[e.jsx(I,{children:e.jsxs(_,{className:"flex items-center text-2xl",children:[e.jsx(Pe,{className:"mr-2 h-6 w-6 text-primary"}),"Explanation (الشرح)"]})}),e.jsx(E,{children:e.jsx("p",{className:"text-lg leading-relaxed whitespace-pre-line text-right",dir:"rtl",children:s})})]});var X="Collapsible",[hs,xe]=ce(X),[fs,W]=hs(X),he=d.forwardRef((s,n)=>{const{__scopeCollapsible:t,open:a,defaultOpen:o,disabled:r,onOpenChange:i,...l}=s,[p=!1,m]=Z({prop:a,defaultProp:o,onChange:i});return e.jsx(fs,{scope:t,disabled:r,contentId:de(),open:p,onOpenToggle:d.useCallback(()=>m(h=>!h),[m]),children:e.jsx($.div,{"data-state":se(p),"data-disabled":r?"":void 0,...l,ref:n})})});he.displayName=X;var fe="CollapsibleTrigger",ge=d.forwardRef((s,n)=>{const{__scopeCollapsible:t,...a}=s,o=W(fe,t);return e.jsx($.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":se(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...a,ref:n,onClick:pe(s.onClick,o.onOpenToggle)})});ge.displayName=fe;var ee="CollapsibleContent",be=d.forwardRef((s,n)=>{const{forceMount:t,...a}=s,o=W(ee,s.__scopeCollapsible);return e.jsx($e,{present:t||o.open,children:({present:r})=>e.jsx(gs,{...a,ref:n,present:r})})});be.displayName=ee;var gs=d.forwardRef((s,n)=>{const{__scopeCollapsible:t,present:a,children:o,...r}=s,i=W(ee,t),[l,p]=d.useState(a),m=d.useRef(null),h=me(n,m),f=d.useRef(0),v=f.current,b=d.useRef(0),A=b.current,g=i.open||l,x=d.useRef(g),j=d.useRef(void 0);return d.useEffect(()=>{const u=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(u)},[]),Le(()=>{const u=m.current;if(u){j.current=j.current||{transitionDuration:u.style.transitionDuration,animationName:u.style.animationName},u.style.transitionDuration="0s",u.style.animationName="none";const C=u.getBoundingClientRect();f.current=C.height,b.current=C.width,x.current||(u.style.transitionDuration=j.current.transitionDuration,u.style.animationName=j.current.animationName),p(a)}},[i.open,a]),e.jsx($.div,{"data-state":se(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!g,...r,ref:h,style:{"--radix-collapsible-content-height":v?`${v}px`:void 0,"--radix-collapsible-content-width":A?`${A}px`:void 0,...s.style},children:g&&o})});function se(s){return s?"open":"closed"}var bs=he,js=ge,vs=be,w="Accordion",Ns=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[te,As,ws]=De(w),[H,Fs]=ce(w,[ws,xe]),ne=xe(),je=N.forwardRef((s,n)=>{const{type:t,...a}=s,o=a,r=a;return e.jsx(te.Provider,{scope:s.__scopeAccordion,children:t==="multiple"?e.jsx(Ts,{...r,ref:n}):e.jsx(ks,{...o,ref:n})})});je.displayName=w;var[ve,Cs]=H(w),[Ne,ys]=H(w,{collapsible:!1}),ks=N.forwardRef((s,n)=>{const{value:t,defaultValue:a,onValueChange:o=()=>{},collapsible:r=!1,...i}=s,[l,p]=Z({prop:t,defaultProp:a,onChange:o});return e.jsx(ve,{scope:s.__scopeAccordion,value:l?[l]:[],onItemOpen:p,onItemClose:N.useCallback(()=>r&&p(""),[r,p]),children:e.jsx(Ne,{scope:s.__scopeAccordion,collapsible:r,children:e.jsx(Ae,{...i,ref:n})})})}),Ts=N.forwardRef((s,n)=>{const{value:t,defaultValue:a,onValueChange:o=()=>{},...r}=s,[i=[],l]=Z({prop:t,defaultProp:a,onChange:o}),p=N.useCallback(h=>l((f=[])=>[...f,h]),[l]),m=N.useCallback(h=>l((f=[])=>f.filter(v=>v!==h)),[l]);return e.jsx(ve,{scope:s.__scopeAccordion,value:i,onItemOpen:p,onItemClose:m,children:e.jsx(Ne,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(Ae,{...r,ref:n})})})}),[Is,B]=H(w),Ae=N.forwardRef((s,n)=>{const{__scopeAccordion:t,disabled:a,dir:o,orientation:r="vertical",...i}=s,l=N.useRef(null),p=me(l,n),m=As(t),f=Oe(o)==="ltr",v=pe(s.onKeyDown,b=>{if(!Ns.includes(b.key))return;const A=b.target,g=m().filter(G=>!G.ref.current?.disabled),x=g.findIndex(G=>G.ref.current===A),j=g.length;if(x===-1)return;b.preventDefault();let u=x;const C=0,z=j-1,Q=()=>{u=x+1,u>z&&(u=C)},U=()=>{u=x-1,u<C&&(u=z)};switch(b.key){case"Home":u=C;break;case"End":u=z;break;case"ArrowRight":r==="horizontal"&&(f?Q():U());break;case"ArrowDown":r==="vertical"&&Q();break;case"ArrowLeft":r==="horizontal"&&(f?U():Q());break;case"ArrowUp":r==="vertical"&&U();break}const Me=u%j;g[Me].ref.current?.focus()});return e.jsx(Is,{scope:t,disabled:a,direction:o,orientation:r,children:e.jsx(te.Slot,{scope:t,children:e.jsx($.div,{...i,"data-orientation":r,ref:p,onKeyDown:a?void 0:v})})})}),O="AccordionItem",[_s,ae]=H(O),we=N.forwardRef((s,n)=>{const{__scopeAccordion:t,value:a,...o}=s,r=B(O,t),i=Cs(O,t),l=ne(t),p=de(),m=a&&i.value.includes(a)||!1,h=r.disabled||s.disabled;return e.jsx(_s,{scope:t,open:m,disabled:h,triggerId:p,children:e.jsx(bs,{"data-orientation":r.orientation,"data-state":_e(m),...l,...o,ref:n,disabled:h,open:m,onOpenChange:f=>{f?i.onItemOpen(a):i.onItemClose(a)}})})});we.displayName=O;var Ce="AccordionHeader",ye=N.forwardRef((s,n)=>{const{__scopeAccordion:t,...a}=s,o=B(w,t),r=ae(Ce,t);return e.jsx($.h3,{"data-orientation":o.orientation,"data-state":_e(r.open),"data-disabled":r.disabled?"":void 0,...a,ref:n})});ye.displayName=Ce;var J="AccordionTrigger",ke=N.forwardRef((s,n)=>{const{__scopeAccordion:t,...a}=s,o=B(w,t),r=ae(J,t),i=ys(J,t),l=ne(t);return e.jsx(te.ItemSlot,{scope:t,children:e.jsx(js,{"aria-disabled":r.open&&!i.collapsible||void 0,"data-orientation":o.orientation,id:r.triggerId,...l,...a,ref:n})})});ke.displayName=J;var Te="AccordionContent",Ie=N.forwardRef((s,n)=>{const{__scopeAccordion:t,...a}=s,o=B(w,t),r=ae(Te,t),i=ne(t);return e.jsx(vs,{role:"region","aria-labelledby":r.triggerId,"data-orientation":o.orientation,...i,...a,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});Ie.displayName=Te;function _e(s){return s?"open":"closed"}var Es=je,Rs=we,Ms=ye,Ee=ke,Re=Ie;const re=Es,V=d.forwardRef(({className:s,...n},t)=>e.jsx(Rs,{ref:t,className:q("border-b",s),...n}));V.displayName="AccordionItem";const Y=d.forwardRef(({className:s,children:n,...t},a)=>e.jsx(Ms,{className:"flex",children:e.jsxs(Ee,{ref:a,className:q("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...t,children:[n,e.jsx(qe,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Y.displayName=Ee.displayName;const F=d.forwardRef(({className:s,children:n,...t},a)=>e.jsx(Re,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...t,children:e.jsx("div",{className:q("pb-4 pt-0",s),children:n})}));F.displayName=Re.displayName;const Ss=({examples:s})=>!s||s.length===0?null:e.jsxs(T,{className:"mb-6 shadow-lg",children:[e.jsx(I,{children:e.jsxs(_,{className:"flex items-center text-2xl",children:[e.jsx(He,{className:"mr-2 h-6 w-6 text-primary"}),"Examples (أمثلة)"]})}),e.jsx(E,{children:e.jsx(re,{type:"single",collapsible:!0,className:"w-full",defaultValue:"item-0",children:s.map((n,t)=>e.jsxs(V,{value:`item-${t}`,children:[e.jsxs(Y,{className:"text-lg hover:no-underline",children:["Example ",t+1]}),e.jsx(F,{children:e.jsxs("div",{className:"space-y-3 p-2",children:[e.jsxs("p",{className:"text-md",children:[e.jsx("span",{className:"font-semibold",children:"English:"})," ",n.english.split("*").map((a,o)=>o%2===1?e.jsx("strong",{className:"text-accent",children:a},o):a)]}),e.jsxs("p",{className:"text-md text-right",dir:"rtl",children:[e.jsx("span",{className:"font-semibold ml-1",children:":عربي"})," ",n.arabic.split("*").map((a,o)=>o%2===1?e.jsx("strong",{className:"text-accent",children:a},o):a)]})]})})]},t))})})]}),Ps=({notes:s,notesArabic:n})=>!s&&!n?null:e.jsxs(T,{className:"mb-6 shadow-lg border-primary/50",children:[e.jsx(I,{children:e.jsxs(_,{as:"h3",className:"flex items-center text-2xl text-primary",children:[e.jsx(cs,{className:"mr-2 h-6 w-6"}),"Additional Notes (ملاحظات إضافية)"]})}),e.jsx(E,{children:e.jsx(re,{type:"single",collapsible:!0,defaultValue:"item-1",className:"w-full",children:e.jsxs(V,{value:"item-1",children:[e.jsx(Y,{className:"text-lg hover:no-underline",children:"Toggle Notes"}),e.jsxs(F,{children:[s&&e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-md leading-relaxed whitespace-pre-line",children:s})}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"text-md font-semibold text-primary/90 mb-1",children:"(بالعربية)"}),e.jsx("p",{className:"text-md leading-relaxed whitespace-pre-line text-right",dir:"rtl",children:n})]})]})]})})})]}),$s=({mistakes:s,mistakesArabic:n})=>!s&&!n?null:e.jsxs(T,{className:"mb-6 shadow-lg",children:[e.jsx(I,{children:e.jsxs(_,{as:"h3",className:"flex items-center text-2xl",children:[e.jsx(ps,{className:"mr-2 h-6 w-6 text-destructive"}),"Common Mistakes (أخطاء شائعة)"]})}),e.jsx(E,{children:e.jsx(re,{type:"single",collapsible:!0,defaultValue:"item-1",className:"w-full",children:e.jsxs(V,{value:"item-1",children:[e.jsx(Y,{className:"text-lg hover:no-underline",children:"Toggle Mistakes"}),e.jsxs(F,{children:[s&&e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-md leading-relaxed whitespace-pre-line",children:s})}),n&&e.jsxs("div",{children:[e.jsx("p",{className:"text-md font-semibold text-destructive/90 mb-1",children:"(بالعربية)"}),e.jsx("p",{className:"text-md leading-relaxed whitespace-pre-line text-right",dir:"rtl",children:n})]})]})]})})})]});R({lessonTitle:c().describe("The title of the lesson."),lessonTopic:c().describe("The topic of the lesson."),lessonLevel:c().describe("The level of the lesson (e.g., Beginner, Intermediate, Advanced)."),lessonArabicExplanation:c().describe("The Arabic explanation of the lesson."),lessonExamples:L(R({english:c().describe("The English example."),arabic:c().describe("The Arabic translation of the example."),imagePrompt:c().optional(),imageUrl:c().optional()})).describe("Examples provided in the lesson."),lessonInteractiveExercises:L(R({type:c().describe("The type of the exercise (e.g., multiple_choice)."),question:c().describe("The question of the exercise."),choices:L(c()).optional().describe("The choices for the multiple-choice question."),correct_answer:c().describe("The correct answer to the exercise."),user_answer:c().describe("The user provided answer to the exercise.")})).describe("Interactive exercises in the lesson."),lessonAdditionalNotes:c().optional().describe("Additional notes for the lesson."),lessonCommonMistakes:c().optional().describe("Common mistakes students make in the lesson."),lessonAdditionalNotesArabic:c().optional().describe("Additional notes for the lesson in Arabic."),lessonCommonMistakesArabic:c().optional().describe("Common mistakes students make in the lesson in Arabic.")});async function Ls(s){const{lessonTitle:n,lessonTopic:t,lessonLevel:a,lessonArabicExplanation:o,lessonExamples:r,lessonInteractiveExercises:i,lessonAdditionalNotesArabic:l,lessonCommonMistakesArabic:p}=s,m=r.map(g=>`- English: "${g.english}", Arabic: "${g.arabic}"`).join(`
`),f=[{role:"user",content:`You are an expert AI English language tutor from Speed of Mastery.
Your primary language for providing feedback to students MUST be natural-sounding, clear, and encouraging ARABIC. You can use English for specific grammar terms if necessary, but all explanations and clarifications should be in Arabic.

The student is currently working on a lesson titled "${n}" on the topic of "${t}" at the "${a}" level.
Here is the core lesson content (in Arabic):
Explanation: "${o}"
Examples:
${m}
Additional Notes: "${l||"None"}"
Common Mistakes: "${p||"None"}"

Now, consider the following exercise and the student's answer:
Question: "${i[0].question}"
Correct Answer: "${i[0].correct_answer}"
Student's Answer: "${i[0].user_answer}"

Your task is to provide targeted feedback to the student IN ARABIC.
- If the student's answer is correct, congratulate them in Arabic. You can also offer a small additional tip or encouragement in Arabic to reinforce their learning.
- If the student's answer is incorrect, gently explain IN ARABIC why it's incorrect. Clarify the correct answer IN ARABIC and, if possible, reference the lesson material (like the Arabic explanation or examples) to help them understand. Be encouraging and helpful.

Ensure your entire feedback is in ARABIC. Your response should consist ONLY of the feedback text itself. Do not add any extra text like "Here is the feedback:".`}];return{feedback:(await(await ue({model:"@cf/meta/llama-3-8b-instruct",inputs:{messages:f}})).json()).result.response}}const Ds=({exercise:s,lesson:n,onCorrect:t})=>{const[a,o]=d.useState(null),[r,i]=d.useState(!1),[l,p]=d.useState(null),[m,h]=d.useState(null),[f,v]=d.useTransition(),b=async()=>{if(!a)return;i(!0);const x=a===s.correct_answer;p(x),x&&t(),v(async()=>{try{const j={lessonTitle:n.title,lessonTopic:n.topic,lessonLevel:n.level,lessonArabicExplanation:n.arabic_explanation,lessonExamples:n.examples,lessonInteractiveExercises:[{type:s.type,question:s.question,choices:s.choices,correct_answer:s.correct_answer,user_answer:a}],lessonAdditionalNotes:n.additional_notes,lessonCommonMistakes:n.common_mistakes,lessonAdditionalNotesArabic:n.additional_notes_arabic,lessonCommonMistakesArabic:n.common_mistakes_arabic},u=await Ls(j);h(u.feedback)}catch(j){console.error("Error fetching AI feedback:",j),h("عذرًا، لم أتمكن من الحصول على الملاحظات في الوقت الحالي. يرجى المحاولة مرة أخرى لاحقًا.")}})},A=()=>{o(null),i(!1),p(null),h(null)},g=x=>r?x===s.correct_answer?"text-green-600 dark:text-green-400 font-semibold":x===a&&x!==s.correct_answer?"text-destructive font-semibold":"":"";return e.jsxs(T,{className:"mb-4 shadow-md",children:[e.jsx(I,{children:e.jsx(_,{className:"text-xl",children:s.question})}),e.jsx(E,{children:e.jsx(Be,{value:a??"",onValueChange:o,disabled:r,className:"space-y-3",children:s.choices.map((x,j)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{value:x,id:`${s.question}-choice-${j}`}),e.jsxs(Ye,{htmlFor:`${s.question}-choice-${j}`,className:`text-md cursor-pointer ${g(x)}`,children:[x,r&&x===s.correct_answer&&e.jsx(oe,{className:"inline ml-2 h-5 w-5 text-green-600 dark:text-green-400"}),r&&x===a&&x!==s.correct_answer&&e.jsx(ie,{className:"inline ml-2 h-5 w-5 text-destructive"})]})]},j))})}),e.jsxs(Fe,{className:"flex flex-col items-start space-y-4",children:[r?e.jsx(y,{onClick:A,variant:"outline",className:"w-full sm:w-auto",children:"Try Again"}):e.jsxs(y,{onClick:b,disabled:!a||f,className:"w-full sm:w-auto",children:[f?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Check Answer"]}),r&&l!==null&&e.jsxs(M,{variant:l?"default":"destructive",className:l?"border-green-500 bg-green-50 dark:bg-green-900/30 dark:border-green-700":"",children:[l?e.jsx(oe,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):e.jsx(ie,{className:"h-5 w-5 text-destructive"}),e.jsx(S,{className:l?"text-green-700 dark:text-green-300":"text-destructive-foreground",children:l?"Correct! (صحيح!)":"Incorrect. (غير صحيح.)"}),!l&&e.jsxs(P,{children:["The correct answer is (الإجابة الصحيحة هي): ",e.jsx("strong",{children:s.correct_answer})]})]}),f&&!m&&e.jsxs("div",{className:"flex items-center text-muted-foreground",children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx("span",{children:"Getting feedback from AI tutor... (جاري الحصول على تقييم المعلم الذكي...)"})]}),m&&e.jsxs(M,{variant:"default",className:"mt-4 border-accent bg-accent/10 dark:bg-accent/20",children:[e.jsx(K,{className:"h-5 w-5 text-primary"})," ",e.jsx(S,{className:"text-accent-foreground",children:"AI Tutor Feedback (تقييم المعلم الذكي)"}),e.jsx(P,{className:"text-accent-foreground/80 whitespace-pre-line text-right",dir:"rtl",children:m})]})]})]})},Os=({exercises:s,lesson:n,onCorrectAnswer:t,hasPassed:a})=>!s||s.length===0?null:e.jsxs(T,{className:"mb-6 shadow-lg",children:[e.jsx(I,{children:e.jsxs(_,{className:"flex items-center text-2xl",children:[e.jsx(as,{className:"mr-2 h-6 w-6 text-primary"}),"Interactive Exercises (تمارين تفاعلية)"]})}),e.jsxs(E,{children:[a&&e.jsxs(M,{variant:"default",className:"mb-6 border-green-500 bg-green-50 dark:bg-green-900/30 dark:border-green-700",children:[e.jsx(ze,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),e.jsx(S,{className:"text-green-700 dark:text-green-300",children:"Congratulations! (تهانينا!)"}),e.jsxs(P,{children:["You've passed this lesson's exercises! Feel free to keep practicing.",e.jsx("span",{dir:"rtl",className:"block",children:"لقد نجحت في تمارين هذا الدرس! يمكنك الاستمرار في الممارسة."})]})]}),s.map((o,r)=>o.type==="multiple_choice"?e.jsx(Ds,{exercise:o,lesson:n,onCorrect:t},r):e.jsxs("p",{children:["Unsupported exercise type: ",o.type]},r))]})]});R({studentQuestion:c().describe("The question asked by the student."),lessonTitle:c().describe("The title of the lesson."),lessonTopic:c().describe("The topic of the lesson."),lessonLevel:c().describe("The level of the lesson (e.g., Beginner, Intermediate, Advanced)."),lessonArabicExplanation:c().describe("The Arabic explanation of the lesson."),lessonExamples:L(R({english:c().describe("The English example."),arabic:c().describe("The Arabic translation of the example."),imagePrompt:c().optional(),imageUrl:c().optional()})).describe("Examples provided in the lesson."),lessonAdditionalNotesArabic:c().optional().describe("Additional notes for the lesson in Arabic."),lessonCommonMistakesArabic:c().optional().describe("Common mistakes students make in the lesson in Arabic.")});async function qs(s){const{studentQuestion:n,lessonTitle:t,lessonTopic:a,lessonArabicExplanation:o,lessonExamples:r,lessonAdditionalNotesArabic:i,lessonCommonMistakesArabic:l}=s,p=r.map(g=>`- English: "${g.english}", Arabic: "${g.arabic}"`).join(`
`),m=`You are a specialist AI English language tutor from Speed of Mastery, fluent in English and Arabic.
Your entire response MUST be in natural, helpful, and encouraging Arabic.
Your personality is patient and supportive.`,h=`You are tutoring a student on an English lesson.
Lesson Title: "${t}"
Topic: "${a}"
Level: "${level}"

Here is the core lesson material (in Arabic) you must use to answer the question:
---
Lesson Explanation: "${o}"
---
Lesson Examples:
${p}
---
Additional Notes: "${i||"None"}"
---
Common Mistakes: "${l||"None"}"
---

The student's question is: "${n}"

Your task is to provide a clear, helpful, and concise answer to the student's question **in Arabic only**.
- Base your answer on the lesson material provided.
- If it helps, refer to the lesson explanation or examples to clarify your answer.
- If the student's question is unclear, politely ask for clarification in Arabic, but try to provide a helpful answer first if possible.
- Your response should be complete and ready to display directly to the student. Do not add any extra conversational text like "Here is the answer". Just provide the answer itself.`;return{aiTutorResponse:(await(await ue({model:"@cf/meta/llama-3-8b-instruct",inputs:{messages:[{role:"system",content:m},{role:"user",content:h}]}})).json()).result.response}}const Hs=({isOpen:s,onClose:n,lesson:t})=>{const[a,o]=d.useState(""),[r,i]=d.useState(null),[l,p]=d.useState(null),[m,h]=d.useTransition(),f=async()=>{a.trim()&&(p(null),i(null),h(async()=>{try{const b={studentQuestion:a,lessonTitle:t.title,lessonTopic:t.topic,lessonLevel:t.level,lessonArabicExplanation:t.arabic_explanation,lessonExamples:t.examples.map(g=>({english:g.english,arabic:g.arabic,imagePrompt:g.imagePrompt,imageUrl:g.imageUrl})),lessonAdditionalNotesArabic:t.additional_notes_arabic,lessonCommonMistakesArabic:t.common_mistakes_arabic},A=await qs(b);i(A.aiTutorResponse)}catch(b){console.error("Error fetching AI tutor response:",b),p("عذرًا، لم أتمكن من الحصول على رد من المعلم الذكي في الوقت الحالي. يرجى المحاولة مرة أخرى لاحقًا."),i(null)}}))},v=()=>{o(""),i(null),p(null),n()};return e.jsx(Qe,{open:s,onOpenChange:b=>!b&&v(),children:e.jsxs(Ue,{className:"sm:max-w-[600px] flex flex-col max-h-[90vh]",children:[e.jsxs(Ge,{children:[e.jsxs(Ke,{className:"flex items-center text-2xl",children:[e.jsx(K,{className:"mr-2 h-6 w-6 text-primary"}),"AI Lesson Tutor (مساعد الدرس الذكي)"]}),e.jsx(Je,{dir:"rtl",className:"text-right",children:"اطرح سؤالاً حول هذا الدرس، وسيقوم المعلم الذكي بمساعدتك على فهمه بشكل أفضل. اكتب سؤالك باللغة العربية أو الإنجليزية."})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto space-y-4 p-1 pr-3",children:[r&&e.jsxs(M,{variant:"default",className:"border-accent bg-accent/10 dark:bg-accent/20",children:[e.jsx(K,{className:"h-5 w-5 text-primary"}),e.jsx(S,{className:"text-accent-foreground",children:"AI Tutor's Response (رد المعلم الذكي)"}),e.jsx(P,{className:"text-accent-foreground/90 whitespace-pre-line text-right",dir:"rtl",children:r})]}),m&&!r&&e.jsxs("div",{className:"flex items-center text-muted-foreground p-4 justify-center",children:[e.jsx(D,{className:"mr-2 h-5 w-5 animate-spin"}),e.jsx("span",{children:"جاري الحصول على رد من المعلم الذكي..."})]}),l&&e.jsxs(M,{variant:"destructive",children:[e.jsx(S,{children:"Error (خطأ)"}),e.jsx(P,{children:l})]})]}),e.jsxs("div",{className:"mt-4 space-y-3 pt-4 border-t",children:[e.jsx(Ze,{placeholder:"اكتب سؤالك هنا... (Type your question here...)",value:a,onChange:b=>o(b.target.value),className:"min-h-[80px] text-base",rows:3,dir:a.match(/[\u0600-\u06FF]/)?"rtl":"ltr"}),e.jsxs(Xe,{className:"gap-2 sm:gap-0",children:[e.jsx(y,{variant:"outline",onClick:v,className:"w-full sm:w-auto",children:"Close (إغلاق)"}),e.jsxs(y,{onClick:f,disabled:m||!a.trim(),className:"w-full sm:w-auto",children:[m?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(We,{className:"mr-2 h-4 w-4"}),"Ask AI Tutor (اسأل المعلم الذكي)"]})]})]})]})})},Bs=({lesson:s})=>{const[n,t]=d.useState(!1),[a,o]=d.useState(!1),r=()=>{a||o(!0)};return e.jsxs("div",{className:"space-y-8 relative pb-20",children:[e.jsx(us,{title:s.title,topic:s.topic,level:s.level}),e.jsx(xs,{explanation:s.arabic_explanation}),e.jsx(Ss,{examples:s.examples}),e.jsx(Os,{exercises:s.interactive_exercises,lesson:s,onCorrectAnswer:r,hasPassed:a}),e.jsx(Ps,{notes:s.additional_notes,notesArabic:s.additional_notes_arabic}),e.jsx($s,{mistakes:s.common_mistakes,mistakesArabic:s.common_mistakes_arabic}),e.jsx(y,{onClick:()=>t(!0),className:"fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-xl z-50 p-0","aria-label":"Open AI Lesson Tutor",size:"icon",children:e.jsx(is,{className:"h-7 w-7"})}),n&&e.jsx(Hs,{isOpen:n,onClose:()=>t(!1),lesson:s})]})};function zs({lesson:s}){return e.jsxs("div",{className:"container mx-auto max-w-3xl py-8 px-4",children:[e.jsx("div",{className:"mb-6",children:e.jsx(y,{asChild:!0,variant:"outline",children:e.jsxs(es,{href:"/",children:[e.jsx(ts,{className:"mr-2 h-4 w-4"}),"All Lessons"]})})}),e.jsx(Bs,{lesson:s})]})}export{zs as default};
